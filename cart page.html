<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</title>
<style>
body {
  font-family:'Segoe UI', Tahoma;
  background:#f8f9fa;
  padding:20px;
  direction:rtl;
  position:relative;
}
h2 {
  text-align:center;
  margin-bottom:20px;
}
.back-link {
  position:absolute;
  left:20px;
  top:20px;
  background:#457b9d;
  color:white;
  text-decoration:none;
  padding:8px 14px;
  border-radius:8px;
  font-weight:bold;
  transition:0.3s;
}
.back-link:hover {
  background:#1d3557;
}
.cart-item {
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:10px;
  display:flex;
  align-items:center;
  gap:15px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  justify-content:space-between;
}
.cart-item img {
  width:100px;
  border-radius:10px;
}
.item-info {
  flex:1;
}
.item-actions {
  display:flex;
  flex-direction:column;
  gap:8px;
}
button {
  border:none;
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
  color:#fff;
}
.delete-btn {
  background:#e63946;
}
.edit-btn {
  background:#7c39c9; /* Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†ÙØ³ add-cart:hover */
}
.form-section {
  background:#fff;
  padding:20px;
  border-radius:12px;
  margin-top:25px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
label {
  display:block;
  margin:8px 0 5px;
  font-weight:bold;
}
input, textarea {
  width:100%;
  padding:10px;
  border:1px solid #ccc;
  border-radius:8px;
  margin-bottom:10px;
}
.whatsapp-btn {
  display:block;
  width:100%;
  padding:15px;
  background:#25D366;
  color:white;
  text-align:center;
  border:none;
  border-radius:10px;
  font-size:18px;
  text-decoration:none;
  margin-top:10px;
}
.modal {
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.4);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal-content {
  background:#fff;
  padding:20px;
  border-radius:10px;
  width:300px;
  text-align:center;
}
select, input[type="number"] {
  padding:8px;
  width:100%;
  border:1px solid #ccc;
  border-radius:8px;
}
</style>
</head>
<body>

<a href="products1.html" class="back-link">â¬…ï¸ Ø¹ÙˆØ¯Ø©</a>

<h2>ğŸ›ï¸ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
<div id="cartContainer"></div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ -->
<div class="form-section">
  <h3>ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
  <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
  <input type="text" id="customerName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" required>

  <label>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ (ÙˆØ§ØªØ³Ø§Ø¨):</label>
  <input type="text" id="customerPhone" placeholder="Ù…Ø«Ø§Ù„: 05XXXXXXXX" required maxlength="10" oninput="this.value=this.value.replace(/[^0-9]/g,'')">

  <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
  <input type="email" id="customerEmail" placeholder="example@email.com" required>

  <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„:</label>
  <textarea id="customerAddress" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" required></textarea>

 <button id="whatsappBtn" class="whatsapp-btn">ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>

<!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³ ÙˆØ§Ù„Ù„ÙˆÙ† ÙˆØ§Ù„ÙƒÙ…ÙŠØ© -->
<div class="modal" id="editModal">
  <div class="modal-content">
    <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3>

    <label>Ø§Ù„Ù…Ù‚Ø§Ø³:</label>
    <select id="editSize">
      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³ --</option>
      <option value="S">S</option>
      <option value="M">M</option>
      <option value="L">L</option>
      <option value="XL">XL</option>
    </select>

    <label>Ø§Ù„Ù„ÙˆÙ†:</label>
    <select id="editColor" style="background:#fff;">
      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† --</option>
      <option value="Ø£Ø³ÙˆØ¯">Ø£Ø³ÙˆØ¯</option>
      <option value="Ø£Ø¨ÙŠØ¶">Ø£Ø¨ÙŠØ¶</option>
      <option value="Ø£Ø­Ù…Ø±">Ø£Ø­Ù…Ø±</option>
      <option value="Ø±Ù…Ø§Ø¯ÙŠ">Ø±Ù…Ø§Ø¯ÙŠ</option>
    </select>

    <label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
    <input type="number" id="editQuantity" min="1" max="10" value="1">

    <br>
    <button id="saveEdit" style="background:#7c39c9;">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    <button id="cancelEdit" style="background:#999;">Ø¥Ù„ØºØ§Ø¡</button>
  </div>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
const cartContainer = document.getElementById("cartContainer");
const modal = document.getElementById("editModal");
const editSize = document.getElementById("editSize");
const editColor = document.getElementById("editColor");
const editQuantity = document.getElementById("editQuantity");
let editIndex = null;

/* ğŸ§¾ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø³Ù„Ø© */
function renderCart() {
  cartContainer.innerHTML = "";
  if (cart.length === 0) {
    cartContainer.innerHTML = "<p>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§ ğŸ›ï¸</p>";
    return;
  }

  let totalAll = 0;
  let totalQuantity = 0;

  cart.forEach((item, index) => {
    const div = document.createElement("div");
    div.classList.add("cart-item");

    const priceNum = parseFloat(item.price.replace(/[^0-9.]/g, "")) || 0;
    const quantity = parseInt(item.quantity);
    const totalItem = priceNum * quantity;
    totalAll += totalItem;
    totalQuantity += quantity;

    div.innerHTML = `
      <img src="${item.image}">
      <div class="item-info">
        <h3>${item.name}</h3>
        <p>ğŸ†” Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬: <strong>${item.id || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</strong></p>
        <p>ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${item.price}</p>
        <p>ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©: ${quantity}</p>
        <p>ğŸ¨ Ø§Ù„Ù„ÙˆÙ†: ${item.color}</p>
        <p>ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³: ${item.size}</p>
        <p>ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalItem.toFixed(2)} Ø±.Ø³</p>
      </div>
      <div class="item-actions">
        <button class="edit-btn" onclick="openEdit(${index})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="delete-btn" onclick="deleteItem(${index})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
      </div>
    `;
    cartContainer.appendChild(div);
  });

  const totalDiv = document.createElement("div");
  totalDiv.style.cssText =
    "background:#fff;padding:15px;border-radius:10px;margin-top:10px;text-align:center;font-weight:bold;box-shadow:0 2px 5px rgba(0,0,0,0.1)";
  totalDiv.innerHTML = `
    ğŸ’° <span style="color:#7c39c9;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${totalAll.toFixed(2)} Ø±.Ø³</span><br>
    ğŸ›’ <span style="color:#333;">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ù„Ø©: ${totalQuantity}</span>
  `;
  cartContainer.appendChild(totalDiv);
}

/* âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
const nameInput = document.getElementById("customerName");
nameInput.setAttribute("maxlength", "40");
nameInput.addEventListener("input", () => {
  nameInput.value = nameInput.value.replace(/[^Ø£-ÙŠA-Za-z\s]/g, "");
});

const addressInput = document.getElementById("customerAddress");
addressInput.setAttribute("maxlength", "100");

function deleteItem(index) {
  if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ")) {
    cart.splice(index, 1);
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
  }
}

function openEdit(index) {
  editIndex = index;
  editSize.value = cart[index].size;
  editColor.value = cart[index].color;
  editQuantity.value = cart[index].quantity;
  modal.style.display = "flex";
}

document.getElementById("saveEdit").addEventListener("click", () => {
  const newSize = editSize.value.trim();
  const newColor = editColor.value.trim();
  const newQty = parseInt(editQuantity.value);

  if (!newSize || !newColor || !newQty) {
    alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸");
    return;
  }

  if (editIndex !== null) {
    cart[editIndex].size = newSize;
    cart[editIndex].color = newColor;
    cart[editIndex].quantity = newQty;
    localStorage.setItem("cart", JSON.stringify(cart));
    renderCart();
    modal.style.display = "none";
  }
});

document.getElementById("cancelEdit").addEventListener("click", () => {
  modal.style.display = "none";
});

renderCart();

function validateInputs(name, phone, email, address){
  const phoneRegex = /^05\d{8}$/;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  if(!name || !phone || !email || !address){
    alert("âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
    return false;
  }
  if(!phoneRegex.test(phone)){
    alert("âš ï¸ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­");
    return false;
  }
  if(!emailRegex.test(email)){
    alert("âš ï¸ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ­ÙŠØ­");
    return false;
  }
  return true;
}
document.getElementById("whatsappBtn").addEventListener("click", async ()=>{

  const name = document.getElementById("customerName").value.trim();
  const phone = document.getElementById("customerPhone").value.trim();
  const email = document.getElementById("customerEmail").value.trim();
  const address = document.getElementById("customerAddress").value.trim();

  if(!validateInputs(name, phone, email, address)) return;
  if(cart.length === 0){
    alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
    return;
  }

  const totalQuantity = cart.reduce((sum, item)=> sum + parseInt(item.quantity), 0);

  const msg = cart.map(item =>
`ğŸ†” Ø±Ù‚Ù… Ø§Ù„Ù…Ù†ØªØ¬: ${item.id || "ØºÙŠØ± Ù…ØªÙˆÙØ±"}
ğŸ›ï¸ Ø§Ù„Ù…Ù†ØªØ¬: ${item.name}
ğŸ’° ${item.price}
ğŸ¨ Ø§Ù„Ù„ÙˆÙ†: ${item.color}
ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³: ${item.size}
ğŸ”¢ Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.quantity}`
  ).join("\n-----------------\n");

  const total = cart.reduce((sum, item)=>{
    const priceNum = parseFloat(item.price.replace(/[^0-9.]/g,"")) || 0;
    return sum + (priceNum * parseInt(item.quantity));
  }, 0);

  const finalMsg =
`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±:

ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}
ğŸ“ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: ${phone}
âœ‰ï¸ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: ${email}
ğŸ“ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„: ${address}

ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:
${msg}

ğŸ›’ Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„ÙƒÙ„ÙŠ: ${totalQuantity}
ğŸ’µ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ : ${total.toFixed(2)} Ø±ÙŠØ§Ù„`;

  try {
    const response = await fetch("process_order.php", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name,
        phone,
        email,
        address,
        total_quantity: totalQuantity,
        total_price: total,
        order_details: msg,
        whatsapp_message: finalMsg
      })
    });

    const data = await response.json();

    if(data.status === "success"){
      window.open(data.url, "_blank");
      localStorage.removeItem("cart");
    } else {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨");
    }

  } catch(error){
    alert("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
  }

});





</script>


</body>
</html>
